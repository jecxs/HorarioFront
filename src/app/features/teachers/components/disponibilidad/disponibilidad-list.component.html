<!-- src/app/features/docentes/components/disponibilidad/disponibilidad-list.component.html -->
<div class="disponibilidad-container">
  <!-- Header -->
  <div class="disponibilidad-header">
    <div class="header-content">
      <h3 class="header-title">
        <mat-icon>schedule</mat-icon>
        Disponibilidad del Docente
      </h3>
      <p class="header-subtitle">
        {{ docente.fullName }} - {{ docente.email }}
      </p>
    </div>

    <div class="header-actions" *ngIf="!readOnly">
      <button
        mat-raised-button
        color="primary"
        [disabled]="showForm"
        (click)="addAvailability(daysOfWeek[0].value)">
        <mat-icon>add</mat-icon>
        Agregar Disponibilidad
      </button>

      <button
        mat-button
        [matMenuTriggerFor]="actionsMenu"
        [disabled]="!hasAvailabilities()">
        <mat-icon>more_vert</mat-icon>
        Más acciones
      </button>

      <mat-menu #actionsMenu="matMenu">
        <button mat-menu-item (click)="confirmDeleteAllAvailabilities()">
          <mat-icon color="warn">delete_sweep</mat-icon>
          <span>Eliminar todas</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando disponibilidades...</p>
  </div>

  <!-- Form for adding/editing availability -->
  <div *ngIf="showForm && !readOnly" class="availability-form-container">
    <mat-card class="form-card">
      <mat-card-content>
        <app-disponibilidad-form
          [initialDay]="selectedDay"
          [daysOfWeek]="daysOfWeek"
          [existingAvailabilities]="availabilities"
          [editingAvailability]="editingAvailability"
          (formSubmit)="onAvailabilityCreated($event)"
          (formUpdate)="onAvailabilityUpdated($event)"
          (formCancel)="onCancelForm()">
        </app-disponibilidad-form>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && !hasAvailabilities() && !showForm" class="empty-state">
    <mat-icon class="empty-icon">event_busy</mat-icon>
    <h3>No hay disponibilidades registradas</h3>
    <p>Este docente no tiene horarios de disponibilidad registrados.</p>
    <button *ngIf="!readOnly" mat-raised-button color="primary" (click)="addAvailability(daysOfWeek[0].value)">
      <mat-icon>add</mat-icon>
      Registrar Disponibilidad
    </button>
  </div>

  <!-- Content with availabilities -->
  <div *ngIf="!loading && hasAvailabilities()" class="disponibilidad-content">
    <!-- Summary card with enhanced stats -->
    <div class="summary-card">
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>analytics</mat-icon>
            Resumen de Disponibilidad
          </mat-card-title>
        </mat-card-header>

        <mat-card-content class="summary-content">
          <div class="summary-grid">
            <div class="summary-item">
              <mat-icon>today</mat-icon>
              <div class="summary-info">
                <span class="summary-value">{{ availabilityStats.daysWithAvailability }} / 7</span>
                <span class="summary-label">Días con disponibilidad</span>
              </div>
            </div>

            <div class="summary-item">
              <mat-icon>schedule</mat-icon>
              <div class="summary-info">
                <span class="summary-value">{{ availabilityStats.totalHours }}h</span>
                <span class="summary-label">Horas totales por semana</span>
              </div>
            </div>

            <div class="summary-item">
              <mat-icon>event_available</mat-icon>
              <div class="summary-info">
                <span class="summary-value">{{ availabilities.length }}</span>
                <span class="summary-label">Bloques de disponibilidad</span>
              </div>
            </div>

            <div class="summary-item">
              <mat-icon>trending_up</mat-icon>
              <div class="summary-info">
                <span class="summary-value">{{ availabilityStats.averageHoursPerDay }}h</span>
                <span class="summary-label">Promedio por día</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Tab group by day -->
    <mat-tab-group class="day-tabs" animationDuration="300ms">
      <mat-tab *ngFor="let day of daysOfWeek" [label]="day.label">
        <ng-template matTabContent>
          <div class="day-content">
            <div class="day-header">
              <h4>{{ day.label }}</h4>
              <div class="day-actions" *ngIf="!readOnly">
                <button
                  mat-button
                  color="primary"
                  (click)="addAvailability(day.value)">
                  <mat-icon>add</mat-icon>
                  Agregar
                </button>

                <!-- Menú de acciones por día -->
                <button
                  mat-icon-button
                  [matMenuTriggerFor]="dayMenu"
                  *ngIf="hasAvailabilitiesForDay(day.value)">
                  <mat-icon>more_vert</mat-icon>
                </button>

                <mat-menu #dayMenu="matMenu">
                  <ng-container *ngFor="let otherDay of daysOfWeek">
                    <button
                      mat-menu-item
                      *ngIf="otherDay.value !== day.value && hasAvailabilitiesForDay(day.value)"
                      (click)="copyFromDay(day.value, otherDay.value)">
                      <mat-icon>content_copy</mat-icon>
                      <span>Copiar a {{ otherDay.label }}</span>
                    </button>
                  </ng-container>
                </mat-menu>
              </div>
            </div>

            <div *ngIf="!hasAvailabilitiesForDay(day.value)" class="day-empty">
              <div class="empty-day-content">
                <mat-icon>schedule_off</mat-icon>
                <p>No hay disponibilidad registrada para {{ day.label }}.</p>
              </div>
            </div>

            <div *ngIf="hasAvailabilitiesForDay(day.value)" class="day-availabilities">
              <div class="availability-cards">
                <mat-card
                  *ngFor="let availability of groupedAvailabilities.get(day.value); trackBy: trackByUuid"
                  class="availability-card">
                  <mat-card-content>
                    <div class="availability-info">
                      <div class="time-info">
                        <div class="time-display">
                          <span class="start-time">{{ formatTime(availability.startTime) }}</span>
                          <mat-icon class="time-separator">trending_flat</mat-icon>
                          <span class="end-time">{{ formatTime(availability.endTime) }}</span>
                        </div>
                        <div class="duration">
                          <mat-icon>schedule</mat-icon>
                          <span>{{ calculateDuration(availability.startTime, availability.endTime) }}</span>
                        </div>
                      </div>

                      <div class="availability-actions" *ngIf="!readOnly">
                        <button
                          mat-icon-button
                          color="primary"
                          matTooltip="Editar"
                          (click)="editAvailability(availability)">
                          <mat-icon>edit</mat-icon>
                        </button>

                        <button
                          mat-icon-button
                          color="warn"
                          matTooltip="Eliminar"
                          (click)="confirmDeleteAvailability(availability)">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </div>
          </div>
        </ng-template>
      </mat-tab>
    </mat-tab-group>

    <!-- Calendar view -->
    <div class="calendar-container">
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>calendar_month</mat-icon>
            Vista de Calendario
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <app-disponibilidad-calendar
            [availabilities]="availabilities"
            [readOnly]="readOnly">
          </app-disponibilidad-calendar>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Saving indicator -->
  <div *ngIf="saving" class="saving-overlay">
    <div class="saving-content">
      <mat-spinner diameter="30"></mat-spinner>
      <span>Guardando cambios...</span>
    </div>
  </div>
</div>
